<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>pages/AccountPage/AccountPage.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#AboutPage">AboutPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#AccountPage">AccountPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#AppFooter">AppFooter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#AppHeader">AppHeader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Breadcrumbs">Breadcrumbs</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#CreateMeetingPage">CreateMeetingPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ForgotPasswordPage">ForgotPasswordPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#NotFoundPage">NotFoundPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#PasswordStrengthHint">PasswordStrengthHint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#RegisterPage">RegisterPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ResetPasswordPage">ResetPasswordPage</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#RotatingText">RotatingText</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Silk">Silk</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#SitemapPage">SitemapPage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#ToastProvider">ToastProvider</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#TopLoadingBar">TopLoadingBar</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#apiFetch">apiFetch</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#auth">auth</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#changePassword">changePassword</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#cleanupAllPeers">cleanupAllPeers</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#closePeer">closePeer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#connectSocket">connectSocket</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#connectVideoSocket">connectVideoSocket</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#connectVoiceSocket">connectVoiceSocket</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#createAndSendOffer">createAndSendOffer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#createMeeting">createMeeting</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#deleteMeetingApi">deleteMeetingApi</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#deleteProfile">deleteProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#disconnectSocket">disconnectSocket</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#disconnectVideoSocket">disconnectVideoSocket</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#disconnectVoiceSocket">disconnectVoiceSocket</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#ensurePeerConnection">ensurePeerConnection</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getAuthToken">getAuthToken</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getIceServers">getIceServers</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getMeeting">getMeeting</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#getProfile">getProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#handleIncomingAnswer">handleIncomingAnswer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#handleIncomingCandidate">handleIncomingCandidate</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#handleIncomingOffer">handleIncomingOffer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#joinRoom">joinRoom</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#joinVideoRoom">joinVideoRoom</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#joinVoiceRoom">joinVoiceRoom</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#leaveVideoRoom">leaveVideoRoom</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#listMeetings">listMeetings</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#loginWithEmailPassword">loginWithEmailPassword</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onChatMessage">onChatMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onExistingUsers">onExistingUsers</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onRoomFull">onRoomFull</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onSocketConnect">onSocketConnect</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onSocketDisconnect">onSocketDisconnect</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onSocketError">onSocketError</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onUserJoined">onUserJoined</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onUserLeft">onUserLeft</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoChatMessage">onVideoChatMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoConnect">onVideoConnect</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoDisconnect">onVideoDisconnect</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoError">onVideoError</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoMediaState">onVideoMediaState</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoMediaStates">onVideoMediaStates</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoRoomError">onVideoRoomError</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoRoomFull">onVideoRoomFull</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoRoomJoined">onVideoRoomJoined</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoScreenShare">onVideoScreenShare</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoSignal">onVideoSignal</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoUserJoined">onVideoUserJoined</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVideoUserLeft">onVideoUserLeft</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceConnect">onVoiceConnect</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceDisconnect">onVoiceDisconnect</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceError">onVoiceError</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceExistingUsers">onVoiceExistingUsers</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoicePeerMediaToggle">onVoicePeerMediaToggle</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceRoomFull">onVoiceRoomFull</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceUserJoined">onVoiceUserJoined</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceUserLeft">onVoiceUserLeft</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceWebrtcAnswer">onVoiceWebrtcAnswer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceWebrtcCandidate">onVoiceWebrtcCandidate</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#onVoiceWebrtcOffer">onVoiceWebrtcOffer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#registerUser">registerUser</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#requestPasswordReset">requestPasswordReset</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#sendChatMessage">sendChatMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#sendVideoChatMessage">sendVideoChatMessage</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#sendVideoMediaState">sendVideoMediaState</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#sendVideoScreenShare">sendVideoScreenShare</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#sendVideoSignal">sendVideoSignal</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#sendVoiceIceCandidate">sendVoiceIceCandidate</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#sendVoiceMediaToggle">sendVoiceMediaToggle</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#sendWebrtcAnswer">sendWebrtcAnswer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#sendWebrtcOffer">sendWebrtcOffer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#setAuthToken">setAuthToken</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#updateEmail">updateEmail</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#updateMeeting">updateMeeting</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#updateProfile">updateProfile</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#useToast">useToast</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">pages/AccountPage/AccountPage.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
/**
 * Account page to edit or delete the user account.
 * GUI-only for Sprint 1. Replace static values with real user data later.
 *
 * @returns {JSX.Element} Profile settings form and danger zone actions.
 */
import { useEffect, useRef, useState } from 'react';
import { Eye, EyeOff } from 'lucide-react';
import { Tooltip } from 'react-tooltip';
import { useToast } from '../../components/layout/ToastProvider';
import { deleteProfile, getProfile, loginWithEmailPassword, changePassword, updateProfile, updateEmail, } from '../../services/api';
import { AUTH_TOKEN_EVENT, getAuthToken, setAuthToken } from '../../services/authToken';
import { PasswordStrengthHint } from '../../components/auth/PasswordStrengthHint';
import './AccountPage.scss';
/**
 * React component for the account / profile settings page.
 * Shows editable personal information and a danger zone for destructive actions.
 *
 * @returns {JSX.Element} Dashboard‑style layout with profile forms.
 */
export function AccountPage() {
    const { showToast } = useToast();
    const [authTokenState, setAuthTokenState] = useState(() => getAuthToken() ?? '');
    const [profile, setProfile] = useState(null);
    const [firstName, setFirstName] = useState('');
    const [lastName, setLastName] = useState('');
    const [age, setAge] = useState('');
    const [email, setEmail] = useState('');
    const [emailFieldError, setEmailFieldError] = useState(null);
    const [bio, setBio] = useState('');
    const [isLoadingProfile, setIsLoadingProfile] = useState(false);
    const [isSavingProfile, setIsSavingProfile] = useState(false);
    const [isUpdatingEmail, setIsUpdatingEmail] = useState(false);
    const [isDeleting, setIsDeleting] = useState(false);
    const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);
    const [isEmailModalOpen, setIsEmailModalOpen] = useState(false);
    const [emailPassword, setEmailPassword] = useState('');
    const [hasTriedEmailConfirm, setHasTriedEmailConfirm] = useState(false);
    const [pendingEmailChange, setPendingEmailChange] = useState(null);
    const [isPasswordModalOpen, setIsPasswordModalOpen] = useState(false);
    const [currentPassword, setCurrentPassword] = useState('');
    const [newPassword, setNewPassword] = useState('');
    const [confirmPassword, setConfirmPassword] = useState('');
    const [isChangingPassword, setIsChangingPassword] = useState(false);
    const [showEmailPassword, setShowEmailPassword] = useState(false);
    const [showCurrentPassword, setShowCurrentPassword] = useState(false);
    const [showNewPassword, setShowNewPassword] = useState(false);
    const [showConfirmPassword, setShowConfirmPassword] = useState(false);
    const emailPasswordRef = useRef(null);
    const currentPasswordRef = useRef(null);
    const deleteConfirmRef = useRef(null);
    const lastFocusedRef = useRef(null);
    const isAuthenticated = Boolean(authTokenState.trim());
    const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\da-zA-Z]).{8,}$/;
    const isStrongPassword = (value) => strongPasswordRegex.test(value);
    const hasNewPassword = newPassword.trim().length > 0;
    const hasConfirmPassword = confirmPassword.trim().length > 0;
    const isNewPasswordStrong = hasNewPassword &amp;&amp; isStrongPassword(newPassword);
    const isPasswordMismatch = hasConfirmPassword &amp;&amp; confirmPassword.trim() !== newPassword.trim();
    const showConfirmPasswordMismatch = isPasswordModalOpen &amp;&amp; hasConfirmPassword &amp;&amp; isPasswordMismatch;
    const showConfirmPasswordMatch = isPasswordModalOpen &amp;&amp; hasConfirmPassword &amp;&amp; !isPasswordMismatch;
    const showEmailPasswordError = isEmailModalOpen &amp;&amp; hasTriedEmailConfirm &amp;&amp; !emailPassword.trim();
    const emailPasswordErrorMessage = showEmailPasswordError
        ? 'Ingresa tu contrasena para confirmar el cambio de correo.'
        : undefined;
    const confirmPasswordErrorMessage = showConfirmPasswordMismatch
        ? 'Las contrasenas deben coincidir.'
        : undefined;
    const confirmPasswordSuccessMessage = showConfirmPasswordMatch
        ? 'Las contrasenas coinciden.'
        : undefined;
    const confirmPasswordTooltipClass = `field-error-tooltip ${confirmPasswordSuccessMessage ? 'field-error-tooltip--success' : 'field-error-tooltip--error'}`;
    const canSubmitPasswordChange = isAuthenticated &amp;&amp;
        Boolean(profile?.email) &amp;&amp;
        currentPassword.trim().length > 0 &amp;&amp;
        isNewPasswordStrong &amp;&amp;
        !isPasswordMismatch;
    const loadProfile = async () => {
        if (!authTokenState.trim()) {
            setProfile(null);
            return;
        }
        setAuthToken(authTokenState.trim());
        setIsLoadingProfile(true);
        try {
            const user = await getProfile();
            setProfile(user);
            setFirstName(user.username ?? '');
            setLastName(user.lastname ?? '');
            setAge(user.birthdate ?? '');
            setEmail(user.email ?? '');
        }
        catch (error) {
            showToast(error.message ?? 'No se pudo cargar el perfil.', 'error');
        }
        finally {
            setIsLoadingProfile(false);
        }
    };
    useEffect(() => {
        loadProfile();
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [authTokenState]);
    useEffect(() => {
        if (isEmailModalOpen) {
            lastFocusedRef.current = document.activeElement;
            emailPasswordRef.current?.focus();
            const handleKeyDown = (event) => {
                if (event.key === 'Escape') {
                    setIsEmailModalOpen(false);
                    setPendingEmailChange(null);
                }
            };
            document.addEventListener('keydown', handleKeyDown);
            return () => document.removeEventListener('keydown', handleKeyDown);
        }
    }, [isEmailModalOpen]);
    useEffect(() => {
        if (isPasswordModalOpen) {
            lastFocusedRef.current = document.activeElement;
            currentPasswordRef.current?.focus();
            const handleKeyDown = (event) => {
                if (event.key === 'Escape') {
                    setIsPasswordModalOpen(false);
                    setCurrentPassword('');
                    setNewPassword('');
                    setConfirmPassword('');
                }
            };
            document.addEventListener('keydown', handleKeyDown);
            return () => document.removeEventListener('keydown', handleKeyDown);
        }
    }, [isPasswordModalOpen]);
    useEffect(() => {
        if (isDeleteDialogOpen) {
            lastFocusedRef.current = document.activeElement;
            deleteConfirmRef.current?.focus();
            const handleKeyDown = (event) => {
                if (event.key === 'Escape') {
                    setIsDeleteDialogOpen(false);
                }
            };
            document.addEventListener('keydown', handleKeyDown);
            return () => document.removeEventListener('keydown', handleKeyDown);
        }
    }, [isDeleteDialogOpen]);
    useEffect(() => {
        const handleAuthChange = () => setAuthTokenState(getAuthToken() ?? '');
        window.addEventListener('storage', handleAuthChange);
        window.addEventListener(AUTH_TOKEN_EVENT, handleAuthChange);
        return () => {
            window.removeEventListener('storage', handleAuthChange);
            window.removeEventListener(AUTH_TOKEN_EVENT, handleAuthChange);
        };
    }, []);
    const runSaveFlow = async (targetEmail) => {
        const emailChanged = profile &amp;&amp; targetEmail !== (profile.email ?? '');
        setIsSavingProfile(true);
        try {
            if (emailChanged) {
                setIsUpdatingEmail(true);
                try {
                    const reauthEmail = profile?.email ?? targetEmail;
                    const loginResponse = await loginWithEmailPassword(reauthEmail, emailPassword);
                    if (loginResponse?.idToken) {
                        setAuthToken(loginResponse.idToken);
                    }
                    await updateEmail(targetEmail);
                }
                finally {
                    setIsUpdatingEmail(false);
                }
            }
            await updateProfile({
                username: firstName.trim(),
                lastname: lastName.trim(),
                birthdate: age.trim(),
            });
            showToast('Perfil actualizado', 'success');
            setEmailFieldError(null);
            setEmailPassword('');
            setPendingEmailChange(null);
            setIsEmailModalOpen(false);
            await loadProfile();
        }
        catch (error) {
            const message = error?.message ?? 'No se pudieron guardar los cambios.';
            setEmailFieldError('Revisa el formato del correo o si ya está en uso y vuelve a intentar.');
            showToast(message, 'error');
            if (emailChanged) {
                setIsEmailModalOpen(false);
                setPendingEmailChange(null);
                setEmailPassword('');
            }
        }
        finally {
            setIsSavingProfile(false);
        }
    };
    const handleSaveProfile = async (event) => {
        event.preventDefault();
        if (!isAuthenticated) {
            showToast('Inicia sesion para continuar.', 'error');
            return;
        }
        const trimmedEmail = email.trim();
        const emailChanged = profile &amp;&amp; trimmedEmail !== (profile.email ?? '');
        if (emailChanged &amp;&amp; !emailPassword.trim()) {
            setPendingEmailChange(trimmedEmail);
            setHasTriedEmailConfirm(false);
            setIsEmailModalOpen(true);
            return;
        }
        await runSaveFlow(trimmedEmail);
    };
    const handleUpdateEmail = async () => {
        if (!isAuthenticated) {
            showToast('Inicia sesion para continuar.', 'error');
            return;
        }
        setIsUpdatingEmail(true);
        try {
            await updateEmail(email.trim());
            showToast('Correo actualizado', 'success');
            setEmailFieldError(null);
            await loadProfile();
        }
        catch (error) {
            setEmailFieldError('Revisa el correo: formato valido o uno diferente si este ya existe.');
            showToast(error.message ?? 'No se pudo actualizar el correo.', 'error');
        }
        finally {
            setIsUpdatingEmail(false);
        }
    };
    const handleConfirmEmailChange = async () => {
        if (!pendingEmailChange) {
            setIsEmailModalOpen(false);
            return;
        }
        if (!emailPassword.trim()) {
            showToast('Ingresa tu contrasena para actualizar el correo.', 'error');
            return;
        }
        await runSaveFlow(pendingEmailChange);
        lastFocusedRef.current?.focus();
    };
    const handleChangePassword = async (event) => {
        event.preventDefault();
        if (!isAuthenticated || !profile?.email) {
            showToast('Inicia sesion para continuar.', 'error');
            return;
        }
        if (!currentPassword.trim() || !newPassword.trim() || !confirmPassword.trim()) {
            showToast('Completa las contrasenas.', 'error');
            return;
        }
        if (!isNewPasswordStrong) {
            showToast('Usa una contrasena fuerte (8+ chars, mayus/minus/numero/simbolo).', 'error');
            return;
        }
        if (newPassword !== confirmPassword) {
            showToast('Las contrasenas no coinciden.', 'error');
            return;
        }
        setIsChangingPassword(true);
        try {
            await changePassword(profile.email, currentPassword.trim(), newPassword.trim());
            showToast('Contrasena actualizada', 'success');
            setIsPasswordModalOpen(false);
            setCurrentPassword('');
            setNewPassword('');
            setConfirmPassword('');
        }
        catch (error) {
            const message = error?.message ?? 'No se pudo cambiar la contrasena.';
            showToast(message, 'error');
            setIsPasswordModalOpen(false);
            setCurrentPassword('');
            setNewPassword('');
            setConfirmPassword('');
        }
        finally {
            setIsChangingPassword(false);
        }
    };
    const handleDeleteProfile = async () => {
        if (!isAuthenticated) {
            showToast('Inicia sesión para continuar.', 'error');
            return;
        }
        setIsDeleting(true);
        try {
            await deleteProfile();
            showToast('Cuenta eliminada', 'success');
            setAuthToken(null);
            setProfile(null);
            setIsDeleteDialogOpen(false);
        }
        catch (error) {
            showToast(error.message ?? 'No se pudo eliminar la cuenta.', 'error');
        }
        finally {
            setIsDeleting(false);
        }
    };
    return (_jsx("div", { className: "dashboard-wrapper", children: _jsx("div", { className: "container", children: _jsxs("section", { className: "dashboard-card account-card", "aria-labelledby": "account-title", children: [_jsx("header", { className: "dashboard-main-header account-header", children: _jsxs("div", { children: [_jsx("h1", { id: "account-title", children: "Configuracion de Perfil" }), _jsx("p", { children: "Administra la informacion de tu cuenta y tu historial de videoconferencias." }), _jsxs("div", { className: "form-group", style: { marginTop: '12px' }, children: [_jsx("span", { className: `badge ${isAuthenticated ? 'badge-success' : 'badge-warning'}`, "aria-label": "Estado de autenticacion", children: isAuthenticated ? 'Sesión activa' : 'Sin sesión' }), !isAuthenticated &amp;&amp; (_jsx("p", { className: "field-help", children: "Inicia sesi\u00F3n para cargar y editar tu perfil." }))] })] }) }), _jsxs("section", { className: "account-section", "aria-labelledby": "account-info-title", children: [_jsx("h2", { id: "account-info-title", className: "account-section-title", children: "Informaci\u00F3n de la cuenta" }), _jsx("p", { className: "card-subtitle", children: "Actualiza tus datos personales b\u00E1sicos. M\u00E1s adelante estos datos se cargar\u00E1n desde el backend." }), _jsxs("form", { onSubmit: handleSaveProfile, children: [_jsxs("div", { className: "account-form-row", children: [_jsxs("div", { className: "form-group", children: [_jsx("label", { className: "form-label", htmlFor: "firstName", children: "Nombre" }), _jsx("div", { className: "field-wrapper", children: _jsx("input", { className: "form-input", id: "firstName", name: "firstName", type: "text", value: firstName, onChange: (event) => setFirstName(event.target.value), required: true, disabled: !isAuthenticated || isLoadingProfile }) })] }), _jsxs("div", { className: "form-group", children: [_jsx("label", { className: "form-label", htmlFor: "lastName", children: "Apellido" }), _jsx("div", { className: "field-wrapper", children: _jsx("input", { className: "form-input", id: "lastName", name: "lastName", type: "text", value: lastName, onChange: (event) => setLastName(event.target.value), required: true, disabled: !isAuthenticated || isLoadingProfile }) })] })] }), _jsxs("div", { className: "form-group", children: [_jsx("label", { className: "form-label", htmlFor: "age", children: "Edad" }), _jsx("div", { className: "field-wrapper", children: _jsx("input", { className: "form-input", id: "age", name: "age", type: "number", min: 0, max: 120, inputMode: "numeric", value: age, onChange: (event) => setAge(event.target.value), required: true, disabled: !isAuthenticated || isLoadingProfile }) })] }), _jsxs("div", { className: "form-group", children: [_jsx("label", { className: "form-label", htmlFor: "email", children: "Correo electronico" }), _jsx("div", { className: "field-wrapper", children: _jsx("input", { className: "form-input", id: "email", name: "email", type: "email", value: email, "aria-describedby": emailFieldError ? 'account-email-tooltip' : undefined, "data-tooltip-id": "account-email-tooltip", onChange: (event) => {
                                                        setEmail(event.target.value);
                                                        setEmailFieldError(null);
                                                    }, disabled: !isAuthenticated || isLoadingProfile || isSavingProfile || isUpdatingEmail }) }), _jsx(Tooltip, { id: "account-email-tooltip", place: "bottom", offset: 6, className: "field-error-tooltip field-error-tooltip--error", openOnClick: false, isOpen: Boolean(emailFieldError), content: emailFieldError ?? undefined, noArrow: true })] }), _jsxs("div", { className: "form-group", children: [_jsx("label", { className: "form-label", htmlFor: "bio", children: "Biografia" }), _jsx("textarea", { className: "form-textarea", id: "bio", name: "bio", rows: 4, placeholder: "Hablamos un poco sobre ti...", value: bio, onChange: (event) => setBio(event.target.value), disabled: !isAuthenticated || isLoadingProfile })] }), _jsx("button", { type: "submit", className: "btn btn-dark account-save-btn", disabled: !isAuthenticated || isSavingProfile, children: isSavingProfile ? 'Guardando...' : 'Guardar cambios' }), !isAuthenticated &amp;&amp; (_jsx("p", { className: "field-help", children: "Inicia sesi\u00F3n para habilitar el formulario." })), isLoadingProfile &amp;&amp; _jsx("p", { className: "field-help", children: "Cargando perfil..." })] })] }), _jsxs("section", { className: "account-section", "aria-label": "Seguridad de la cuenta", children: [_jsx("h2", { className: "account-section-title", children: "Seguridad" }), _jsx("p", { className: "card-subtitle", children: "Actualiza tu contrasena con una verificacion rapida." }), _jsx("button", { type: "button", className: "btn btn-dark", onClick: () => setIsPasswordModalOpen(true), disabled: !isAuthenticated, children: "Cambiar contrasena" }), !isAuthenticated &amp;&amp; (_jsx("p", { className: "field-help", children: "Inicia sesion para habilitar el cambio de contrasena." }))] }), _jsxs("section", { className: "account-section account-danger", "aria-labelledby": "danger-zone-title", children: [_jsx("h2", { id: "danger-zone-title", className: "account-section-title", children: "Zona de peligro" }), _jsx("p", { className: "card-subtitle", children: "Esta acci\u00F3n eliminar\u00E1 tu cuenta y el historial asociado cuando la funcionalidad est\u00E9 implementada. No se podr\u00E1 deshacer." }), _jsx("button", { type: "button", className: "btn btn-danger account-delete-btn", onClick: () => setIsDeleteDialogOpen(true), disabled: !isAuthenticated, children: "Eliminar cuenta" })] }), isDeleteDialogOpen &amp;&amp; (_jsx("div", { className: "account-dialog-backdrop", role: "presentation", onClick: () => setIsDeleteDialogOpen(false), children: _jsxs("div", { className: "account-dialog", role: "alertdialog", "aria-modal": "true", "aria-labelledby": "delete-dialog-title", "aria-describedby": "delete-dialog-description", onClick: (event) => event.stopPropagation(), children: [_jsx("h3", { id: "delete-dialog-title", children: "\u00BFEliminar cuenta?" }), _jsx("p", { id: "delete-dialog-description", children: "Esta acci\u00F3n eliminar\u00E1 tu cuenta y el historial asociado cuando la funcionalidad est\u00E9 implementada. No se podr\u00E1 deshacer." }), _jsxs("div", { className: "account-dialog-actions", children: [_jsx("button", { type: "button", className: "btn btn-danger", onClick: handleDeleteProfile, ref: deleteConfirmRef, disabled: isDeleting, children: isDeleting ? "Eliminando..." : "Eliminar cuenta" }), _jsx("button", { type: "button", className: "btn account-dialog-cancel", onClick: () => setIsDeleteDialogOpen(false), children: "Cancelar" })] })] }) })), isEmailModalOpen &amp;&amp; (_jsx("div", { className: "account-dialog-backdrop", role: "presentation", onClick: () => {
                            setIsEmailModalOpen(false);
                            setPendingEmailChange(null);
                            setHasTriedEmailConfirm(false);
                            lastFocusedRef.current?.focus();
                        }, children: _jsxs("div", { className: "account-dialog", role: "dialog", "aria-modal": "true", "aria-labelledby": "email-dialog-title", "aria-describedby": "email-dialog-description", onClick: (event) => event.stopPropagation(), children: [_jsx("h3", { id: "email-dialog-title", children: "Confirmar cambio de correo" }), _jsx("p", { id: "email-dialog-description", children: "Por seguridad, ingresa tu contrasena para actualizar el correo." }), _jsxs("div", { className: "form-group", children: [_jsx("label", { className: "form-label", htmlFor: "authPassword", children: "Contrasena" }), _jsxs("div", { className: "field-wrapper", children: [_jsx("input", { className: "form-input", id: "authPassword", name: "authPassword", autoComplete: "current-password", type: showEmailPassword ? 'text' : 'password', value: emailPassword, onChange: (event) => setEmailPassword(event.target.value), disabled: isSavingProfile || isUpdatingEmail, ref: emailPasswordRef, "aria-describedby": showEmailPasswordError ? 'email-password-tooltip' : undefined, "data-tooltip-id": "email-password-tooltip" }), _jsx("button", { type: "button", className: "field-toggle-button", "aria-label": showEmailPassword ? 'Ocultar contrasena' : 'Mostrar contrasena', onClick: () => setShowEmailPassword((prev) => !prev), children: showEmailPassword ? _jsx(EyeOff, { size: 16 }) : _jsx(Eye, { size: 16 }) })] })] }), _jsxs("div", { className: "account-dialog-actions", children: [_jsx("button", { type: "button", className: "btn btn-dark", onClick: handleConfirmEmailChange, disabled: isSavingProfile || isUpdatingEmail, children: isSavingProfile || isUpdatingEmail ? 'Verificando...' : 'Confirmar' }), _jsx("button", { type: "button", className: "btn account-dialog-cancel", onClick: () => {
                                                setIsEmailModalOpen(false);
                                                setPendingEmailChange(null);
                                                setHasTriedEmailConfirm(false);
                                                lastFocusedRef.current?.focus();
                                            }, children: "Cancelar" })] }), _jsx(Tooltip, { id: "email-password-tooltip", place: "bottom", offset: 6, className: "field-error-tooltip field-error-tooltip--error", openOnClick: false, isOpen: Boolean(emailPasswordErrorMessage), content: emailPasswordErrorMessage, noArrow: true })] }) })), isPasswordModalOpen &amp;&amp; (_jsx("div", { className: "account-dialog-backdrop", role: "presentation", onClick: () => {
                            setIsPasswordModalOpen(false);
                            setCurrentPassword('');
                            setNewPassword('');
                            setConfirmPassword('');
                            lastFocusedRef.current?.focus();
                        }, children: _jsxs("div", { className: "account-dialog", role: "dialog", "aria-modal": "true", "aria-labelledby": "password-dialog-title", "aria-describedby": "password-dialog-description", onClick: (event) => event.stopPropagation(), children: [_jsx("h3", { id: "password-dialog-title", children: "Cambiar contrasena" }), _jsx("p", { id: "password-dialog-description", children: "Ingresa tu contrasena actual y la nueva. Si la actual es incorrecta, el proceso se cancelara." }), _jsxs("form", { onSubmit: handleChangePassword, children: [_jsxs("div", { className: "form-group", children: [_jsx("label", { className: "form-label", htmlFor: "currentPassword", children: "Contrasena actual" }), _jsxs("div", { className: "field-wrapper", children: [_jsx("input", { className: "form-input", id: "currentPassword", name: "currentPassword", type: showCurrentPassword ? 'text' : 'password', value: currentPassword, onChange: (event) => setCurrentPassword(event.target.value), disabled: isChangingPassword, required: true, ref: currentPasswordRef }), _jsx("button", { type: "button", className: "field-toggle-button", "aria-label": showCurrentPassword ? 'Ocultar contrasena' : 'Mostrar contrasena', onClick: () => setShowCurrentPassword((prev) => !prev), children: showCurrentPassword ? _jsx(EyeOff, { size: 16 }) : _jsx(Eye, { size: 16 }) })] })] }), _jsxs("div", { className: "form-group", children: [_jsx("label", { className: "form-label", htmlFor: "newPassword", children: "Nueva contrasena" }), _jsxs("div", { className: "field-wrapper", children: [_jsx("input", { className: "form-input", id: "newPassword", name: "newPassword", type: showNewPassword ? 'text' : 'password', value: newPassword, onChange: (event) => setNewPassword(event.target.value), disabled: isChangingPassword, required: true }), _jsx("button", { type: "button", className: "field-toggle-button", "aria-label": showNewPassword ? 'Ocultar contrasena' : 'Mostrar contrasena', onClick: () => setShowNewPassword((prev) => !prev), children: showNewPassword ? _jsx(EyeOff, { size: 16 }) : _jsx(Eye, { size: 16 }) })] }), _jsx(PasswordStrengthHint, { password: newPassword })] }), _jsxs("div", { className: "form-group", children: [_jsx("label", { className: "form-label", htmlFor: "confirmPassword", children: "Confirmar contrasena" }), _jsxs("div", { className: "field-wrapper", children: [_jsx("input", { className: "form-input", id: "confirmPassword", name: "confirmPassword", type: showConfirmPassword ? 'text' : 'password', value: confirmPassword, onChange: (event) => setConfirmPassword(event.target.value), disabled: isChangingPassword, required: true, "aria-describedby": showConfirmPasswordMismatch || showConfirmPasswordMatch
                                                                ? 'confirm-password-tooltip'
                                                                : undefined, "data-tooltip-id": "confirm-password-tooltip" }), _jsx("button", { type: "button", className: "field-toggle-button", "aria-label": showConfirmPassword ? 'Ocultar contrasena' : 'Mostrar contrasena', onClick: () => setShowConfirmPassword((prev) => !prev), children: showConfirmPassword ? _jsx(EyeOff, { size: 16 }) : _jsx(Eye, { size: 16 }) })] })] }), _jsxs("div", { className: "account-dialog-actions", children: [_jsx("button", { type: "submit", className: "btn btn-dark", disabled: isChangingPassword || !canSubmitPasswordChange, children: isChangingPassword ? 'Guardando...' : 'Guardar' }), _jsx("button", { type: "button", className: "btn account-dialog-cancel", onClick: () => {
                                                        setIsPasswordModalOpen(false);
                                                        setCurrentPassword('');
                                                        setNewPassword('');
                                                        setConfirmPassword('');
                                                        lastFocusedRef.current?.focus();
                                                    }, children: "Cancelar" })] })] }), _jsx(Tooltip, { id: "confirm-password-tooltip", place: "bottom", offset: 6, className: confirmPasswordTooltipClass, openOnClick: false, isOpen: Boolean(confirmPasswordErrorMessage || confirmPasswordSuccessMessage), content: confirmPasswordErrorMessage ?? confirmPasswordSuccessMessage, noArrow: true })] }) }))] }) }) }));
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Thu Dec 11 2025 00:35:36 GMT-0500 (hora estándar de Colombia) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
